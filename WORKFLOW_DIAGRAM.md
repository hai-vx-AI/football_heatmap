# ğŸ¯ SÆ  Äá»’ QUY TRÃŒNH

## ğŸ“Š Workflow Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FOOTBALL BALL TRACKING                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. DATASET  â”‚  â† dow.py
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CONVERT  â”‚  â† convert_mot_to_yolo.py
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    (MOT â†’ YOLO format)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. PREPARE  â”‚  â† prepare_crop_data.py
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    (Cáº¯t crops 64x64)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. TRAIN    â”‚  â† train_tiny.py
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    (Train BallRefinerNet)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. MODEL    â”‚  â†’ tiny_ball_refiner.pth
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         6. INFERENCE/TRACKING        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ test_video.py (quick test)        â”‚
â”‚  â€¢ test_with_gt.py (vá»›i GT)          â”‚
â”‚  â€¢ run_tracking_enhanced.py â­       â”‚
â”‚  â€¢ run_tracking_test.py (full)       â”‚
â”‚  â€¢ smart_tracking.py (production)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. OUTPUT   â”‚  â†’ output/videos/*.mp4
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  Kiáº¿n trÃºc Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BallRefinerNet Architecture            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: 64x64x3 RGB Image
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv1 (16)      â”‚  + ReLU + MaxPool â†’ 32x32
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv2 (32)      â”‚  + ReLU + MaxPool â†’ 16x16
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv3 (64)      â”‚  + ReLU + MaxPool â†’ 8x8
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flatten         â”‚  â†’ 4096 features
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FC (256)        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚        â”‚
     â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Classifierâ”‚ â”‚Regressor â”‚
â”‚  (1)     â”‚ â”‚  (2)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â–¼           â–¼
  conf       (dx, dy)
  0-1        -1 to 1
```

---

## ğŸ® Tracking Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SMART TRACKING WORKFLOW              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frame N
   â”‚
   â”œâ”€â”€â”€ Is Lost? â”€â”€NOâ”€â”€> Kalman Predict Position
   â”‚                            â”‚
   â”‚                            â–¼
   â”‚                     Crop 64x64 around prediction
   â”‚                            â”‚
   â”‚                            â–¼
   â”‚                     Tiny-Net Inference
   â”‚                            â”‚
   â”‚                            â–¼
   â”‚                     Confidence > 0.7?
   â”‚                      â”‚            â”‚
   â”‚                     YES          NO
   â”‚                      â”‚            â”‚
   â”‚                      â–¼            â”‚
   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
   â”‚              â”‚ FOUND (Local)â”‚     â”‚
   â”‚              â”‚  Green dot   â”‚     â”‚
   â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚                     â”‚             â”‚
   YES <â”€â”€ Lost â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
YOLO Global Search (full frame)
   â”‚
   â–¼
Ball Found?
   â”‚
   â”œâ”€YESâ”€> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚       â”‚FOUND (Global)â”‚
   â”‚       â”‚   Red dot    â”‚
   â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚              â”‚
   â””â”€NOâ”€â”€> LOST   â”‚
           â”‚      â”‚
           â–¼      â–¼
      Update Tracker
           â”‚
           â–¼
       Next Frame
```

---

## ğŸ“‚ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATA ORGANIZATION                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

input/
â”œâ”€â”€ SoccerNet/
â”‚   â”œâ”€â”€ tracking-2023/        â† Raw MOT format
â”‚   â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â”‚   â”œâ”€â”€ SNMOT-060/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gt/gt.txt
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ img1/*.jpg
â”‚   â”‚   â””â”€â”€ test/
â”‚   â”‚       â””â”€â”€ SNMOT-116/
â”‚   â”‚
â”‚   â””â”€â”€ yolo_format/          â† Converted YOLO
â”‚       â”œâ”€â”€ images/
â”‚       â”‚   â”œâ”€â”€ train/
â”‚       â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ labels/
â”‚           â”œâ”€â”€ train/
â”‚           â””â”€â”€ test/
â”‚
â””â”€â”€ tiny_dataset/             â† Training crops
    â”œâ”€â”€ pos/                  â† Ball crops
    â”‚   â”œâ”€â”€ ball_0.jpg
    â”‚   â”œâ”€â”€ ball_1.jpg
    â”‚   â””â”€â”€ ...
    â””â”€â”€ neg/                  â† Background crops
        â”œâ”€â”€ bg_0.jpg
        â””â”€â”€ ...

           â†“ train_tiny.py

model/
â””â”€â”€ tiny_ball_refiner.pth     â† Trained model

           â†“ tracking scripts

output/
â””â”€â”€ videos/
    â”œâ”€â”€ tracking_enhanced.mp4 â­ (99% accuracy)
    â”œâ”€â”€ tracking_output.mp4
    â”œâ”€â”€ test_with_gt.mp4
    â””â”€â”€ test_output.mp4
```

---

## ğŸ¯ CÃ¡c Script theo Má»¥c ÄÃ­ch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      THEO Má»¤C ÄÃCH Sá»¬ Dá»¤NG         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¥ DATA PREPARATION
â”œâ”€â”€ dow.py                 â†’ Download dataset
â”œâ”€â”€ convert_mot_to_yolo.py â†’ Convert format
â””â”€â”€ prepare_crop_data.py   â†’ Create training crops

ğŸ“ TRAINING
â””â”€â”€ train_tiny.py          â†’ Train model

ğŸ§ª TESTING & EVALUATION
â”œâ”€â”€ test_video.py          â†’ Quick test (random sampling)
â”œâ”€â”€ test_with_gt.py        â†’ Detailed evaluation with GT
â”œâ”€â”€ run_tracking_test.py   â†’ Full pipeline test
â””â”€â”€ run_tracking_enhanced.py â­ â†’ Best demo (99% acc)

ğŸš€ PRODUCTION
â””â”€â”€ smart_tracking.py      â†’ Real video tracking

ğŸ§  CORE
â”œâ”€â”€ model_tiny.py          â†’ Model definition
â””â”€â”€ tiny_ball_refiner.pth  â†’ Trained weights
```

---

## â±ï¸ Timeline Æ¯á»›c TÃ­nh

```
SETUP & TRAINING (First time only)
â”œâ”€â”€ 1. Download dataset       â†’ 30-60 min (one-time)
â”œâ”€â”€ 2. Convert format         â†’ 5-10 min
â”œâ”€â”€ 3. Prepare crops          â†’ 10-15 min
â””â”€â”€ 4. Train model            â†’ 3-5 min/epoch Ã— 10 = 30-50 min
                               TOTAL: ~1-2 hours

INFERENCE (Anytime)
â”œâ”€â”€ test_video.py             â†’ ~8 seconds (100 frames)
â”œâ”€â”€ test_with_gt.py           â†’ ~2.5 minutes (150 frames)
â”œâ”€â”€ run_tracking_enhanced.py  â†’ ~2 minutes (300 frames)
â””â”€â”€ run_tracking_test.py      â†’ ~20 seconds (300 frames)
```

---

## ğŸ† Káº¿t Quáº£ Äáº¡t ÄÆ°á»£c

```
MODEL PERFORMANCE
â”œâ”€â”€ Accuracy: 99%
â”œâ”€â”€ Recall: 100%
â”œâ”€â”€ Precision: 99%
â””â”€â”€ Speed: ~17ms/batch (CPU)

VIDEO OUTPUTS
â”œâ”€â”€ tracking_enhanced.mp4    â­ Best (99% accuracy)
â”œâ”€â”€ test_with_gt.mp4         (100% recall)
â”œâ”€â”€ tracking_output.mp4      (Full pipeline)
â””â”€â”€ test_output.mp4          (Random sampling)

DATASET
â”œâ”€â”€ Training images: ~20,000+
â”œâ”€â”€ Positive crops: ~5,000+
â””â”€â”€ Negative crops: ~10,000+
```
